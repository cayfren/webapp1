// Replace the YES button event listener in your webapp with this:

yesBtn.addEventListener('click', async () => {
  if (!pendingConfirmation) return;
  
  appendMessage(createMessageNode({text: 'YES', role:'user'}));
  
  const payload = {
    chatId: chatId,
    message: 'yes',
    confirmation_type: pendingConfirmation.confirmation_type,
    customer_id: pendingConfirmation.customer_id || null,
    vendor_id: pendingConfirmation.vendor_id || null,  // ADD THIS LINE
    invoice_id: pendingConfirmation.invoice_id || null
  };
  
  hideConfirmationMode();
  await sendToWebhook(payload);
});

// And update the sendToWebhook function to include vendor_id:

async function sendToWebhook(payload, file = null) {
  const typingNode = createTypingNode();
  appendMessage(typingNode);

  waitingForResponse = true;
  sendBtn.disabled = true;

  try {
    const form = new FormData();
    form.append('chatId', payload.chatId);
    form.append('message', payload.message);
    if (payload.confirmation_type) form.append('confirmation_type', payload.confirmation_type);
    if (payload.customer_id) form.append('customer_id', payload.customer_id);
    if (payload.vendor_id) form.append('vendor_id', payload.vendor_id);  // ADD THIS LINE
    if (payload.invoice_id) form.append('invoice_id', payload.invoice_id);
    if (file) form.append('file', file, file.name);

    const resp = await fetch(webhookURL, {
      method: 'POST',
      body: form
    });

    typingNode.remove();

    const contentType = resp.headers.get('content-type') || '';

    if (contentType.includes('application/json') || contentType.includes('text/json')) {
      const json = await resp.json();
      handleJsonResponse(json);
    } else {
      const textResp = await resp.text();
      appendMessage(createMessageNode({text: textResp, role:'bot'}));
    }
  } catch (err) {
    typingNode.remove();
    appendMessage(createMessageNode({text: 'Error: ' + (err.message || String(err)), role:'bot'}));
    console.error('Send error', err);
  } finally {
    waitingForResponse = false;
    sendBtn.disabled = false;
  }
}
